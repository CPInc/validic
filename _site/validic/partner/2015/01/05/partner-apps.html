<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Partner Apps</title>
    <meta name="description" content="This is page is a work in progress to help showcase the many uses of the Validic gem.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://yourdomain.com/validic/partner/2015/01/05/partner-apps.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Validic Gem Github Page</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Partner Apps</h1>
    <p class="post-meta">Jan 5, 2015 • Anthony Ross</p>
  </header>

  <article class="post-content">
    <h2 id="getting-started">Getting started</h2>

<p>The purpose of this post is two fold - 1.)  register yourself as a Partner Application in Validic and 2.) use the <a href="https://github.com/validic/validic">Validic Ruby Gem</a>.</p>

<h1 id="why-validic-connect">Why Validic Connect</h1>
<p>Validic Connect was developed for app developers by app developers.  Registering your app with Validic will allow existing Validic users to see your app in our marketplace exposing your app to the millions of users we have.  Typically an organization like Fitbit already has an API that we are able to integrate into Validic.</p>

<p>Validic Connect does not require you have a standard API but instead allows you to POST data to Validic on behalf of users that request it.  We’ve written libraries in numerous languages to make this process as easy as possible.</p>

<h1 id="registration-and-obtaining-your-credentials">Registration and Obtaining your Credentials</h1>

<p>In order to get started your application must be registered with us. To apply please go <a href="https://validic.com/labs">here</a> and click on ‘request developer account’.</p>

<p>Registration requires:</p>

<ol>
  <li>Your company name</li>
  <li>Your app name</li>
  <li>Authorization URL
    <ul>
      <li>our marketplace will need a link to your app so users can connect to it, see below for more information</li>
    </ul>
  </li>
  <li>Link to your data sharing Terms and Conditions</li>
  <li>Link to your privacy policy</li>
  <li>Your support email address</li>
  <li>Application icon
    <ul>
      <li>jpg, jpeg, png, gif in 200 x 200 no more than 30kb</li>
    </ul>
  </li>
  <li>Which of our objects you plan to implement with
    <ul>
      <li>fitness, routine, nutrition, weight, sleep, diabetes, biometrics, tobacco_cessation</li>
    </ul>
  </li>
  <li>Short description of your application</li>
  <li>Long description of your application</li>
</ol>

<p>Once approved, you will receive back from us 3 things:</p>

<ol>
  <li>Authorization Signature</li>
  <li>Organization ID</li>
  <li>Organization Access Token</li>
</ol>

<p>Authorization URL:</p>

<p>The Authorization URL is a defined resource in your application where Validic will redirect users who make authorization requests from third-party applications. Once received, your application must process this request, but you are free to define how your application will handle the authorization request. Typically, this would be a user login or sign up in your application.</p>

<p>We’ll showcase a good method for implementing this in your app in a later section.</p>

<p>The authorization request is a 302 Redirect to your provided Authorization URL that includes a signature and sync_url. You must temporarily retain these information, such as storing in a session, for a later callback.</p>

<p>So all that means is your authorization page should be RESTful and look something like this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">https://yourdomain.com/validic/your_authorization_url?signature<span class="o">={</span>VALIDIC_AUTH_SIGNATURE<span class="o">}</span><span class="p">&amp;</span><span class="nv">sync_url</span><span class="o">={</span>VALIDIC_SYNC_PATH<span class="o">}</span></code></pre></div>

<p>Once your application has processed the authorization (such as the user has successfully logged in), you must then make a POST request to the provided sync_url with the signature and your user’s uid. You’ll learn more about user’s UID in the User Provisioning section below.</p>

<p>Once registered you may proceed below.</p>

<h1 id="install-the-gem">Install the gem</h1>

<p>Now that you have your organizations partner app credentials you can begin to use our libraries.</p>

<p>In ruby, you can add the gem to your Gemfile</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;validic&#39;</span></code></pre></div>

<p>then run <code>bundle install</code></p>

<h1 id="set-up-your-application">Set Up Your Application</h1>

<p>If you’re using a rails app we recommend storing your organization credentials into environment variables using something like <a href="https://github.com/bkeepers/dotenv">dotenv-rails.</a>
We also recommend setting up an initializer for the gem so your calls automatically contain your organization’s credentials.  In rails that would look like this(<code>config/initializers/validic.rb</code>)</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Validic</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">api_url</span>        <span class="o">=</span> <span class="s1">&#39;https://api.validic.com&#39;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">api_version</span>    <span class="o">=</span> <span class="s1">&#39;v1&#39;</span>
  <span class="n">config</span><span class="o">.</span><span class="n">organization_id</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;VALIDIC_ORG_ID&#39;</span><span class="o">]</span>
  <span class="n">config</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;VALIDIC_ACCESS_TOKEN&#39;</span><span class="o">]</span>
<span class="k">end</span></code></pre></div>

<p>Subsequently this requires you create a <code>.env</code> file with your credentials:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">VALIDIC_ORG_ID</span><span class="o">=</span><span class="no">YOUR_ORG_ID_HERE</span>
<span class="no">VALIDIC_ACCESS_TOKEN</span><span class="o">=</span><span class="no">YOUR_ACCESS_TOKEN_HERE</span></code></pre></div>

<h1 id="add-an-authorization-page">Add an Authorization Page</h1>

<p>We’ve set up a fake partner application call HealthYet that now exists in our marketplace.  When a user clicks ‘Connect’ (as show in the screenshot below), they will land on your authorization page.</p>

<p><img src="/assets/marketplace.jpg" alt="marketplace" /></p>

<p>We set up the HealthYet authorization page in a two step process.  When a user clicks connect, they are redirected to the authorization URL we mentioned above.  For HealthYet that looks like:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">https://healthyyet.herokuapp.com/authorize?signature<span class="o">=</span>Mjg5MGVjMmIwODYzMzAyZTE1NzEwNDljZWJkMWE4MWFlYmQxODk1MWM3Nzg1YTAyNjRjNjBkMmU4ZTVlYzM4OS01NGFkNjU1ODU3ZmIzNWI4ZDUwMDZkYTktL2F1dGhvcml6ZXMvbmV3<span class="p">&amp;</span><span class="nv">sync_url</span><span class="o">=</span>https://app.validic.com/authorization/new</code></pre></div>

<p>Step 1 is we require the user login:</p>

<p><img src="/assets/login.jpg" alt="login" /></p>

<p>Step 2 comes from Validic, we ask the user to explicitly make the connection between the customers organization (here: VMS Healthcare) and your application (the page below is provided by Validic):</p>

<p><img src="/assets/auth.jpg" alt="auth" /></p>

<h1 id="first-steps---user-provisioning">First Steps - User Provisioning</h1>

<p>In order to send your users data you must provision users in Validic.  Provisioning users is a critical step, you will be unable to post data without first provisioning.  In essence, provisioning users is simply creating a user in the Validic database.</p>

<p>We recommend that you provision users once they authorize you to share their data in our marketplace.  The only required field for provisioning users is a unique ID that you provide as a string.  Provisioning users looks like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">client</span> <span class="o">=</span> <span class="no">Validic</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">provision_user</span><span class="p">(</span><span class="s1">&#39;YourUniqueIDAsAString&#39;</span><span class="p">)</span></code></pre></div>

<p>That response will look like this:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">201</span><span class="p">,</span>
  <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Ok&quot;</span><span class="p">,</span>
  <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;{USER_ID}&quot;</span><span class="p">,</span>
    <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;{USER_ACCESS_TOKEN}&quot;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>You need to store the <code>_id</code> and <code>access_token</code> in your database (this information is unique to each user) as we’ll use that information in the forthcoming POST calls. The entire provision user method might look like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">provision_validic</span>
    <span class="n">client</span> <span class="o">=</span> <span class="no">Validic</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">urlsafe_base64</span> <span class="c1">#random string</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">user_provision</span><span class="p">(</span><span class="ss">organization_id</span><span class="p">:</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;VALIDIC_ORG_ID&#39;</span><span class="o">]</span><span class="p">,</span>
                                 <span class="ss">uid</span><span class="p">:</span> <span class="n">uid</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">_id</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">access_token</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">save</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="c1">#find the user who just authorized</span>
<span class="n">user</span><span class="o">.</span><span class="n">provision_validic</span> <span class="c1">#provision in Validic</span></code></pre></div>

<h1 id="posting-data-to-validic">Posting Data to Validic</h1>

<p>We’re going to assume that once a user has authorized their data be shared with Validic you want to immediately send all new data of that users to Validic.  For instance, let’s say we have an Activity class that once new data has been validated and saved on your server, it should also be pushed to Validic.  You can use a <code>after_save</code> hook in rails to do just that:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Activity</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:steps</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">after_save</span> <span class="ss">:push_to_validic</span>

  <span class="k">def</span> <span class="nf">push_to_validic</span>
    <span class="c1">#you can do some check here to make sure user has authorized sending data to Validic</span>
    <span class="n">client</span> <span class="o">=</span> <span class="no">Validic</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span>
    <span class="no">Validic</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">_id</span> <span class="c1"># we have this _id from the provision call above</span>
    <span class="n">client</span><span class="o">.</span><span class="n">post_to_validic</span><span class="p">(</span><span class="s2">&quot;routine&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="ss">routine</span><span class="p">:</span> <span class="p">{</span>
        <span class="ss">timestamp</span><span class="p">:</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:iso8601</span><span class="p">),</span>
        <span class="ss">steps</span><span class="p">:</span> <span class="nb">self</span><span class="o">.</span><span class="n">steps</span><span class="p">,</span>
        <span class="ss">activity_id</span><span class="p">:</span> <span class="nb">self</span><span class="o">.</span><span class="n">unique_activity_id</span><span class="p">,</span>
        <span class="ss">extras</span><span class="p">:</span> <span class="s2">&quot;{ </span><span class="se">\&quot;</span><span class="s2">points</span><span class="se">\&quot;</span><span class="s2">: 10}&quot;</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>If a new activity is created here, it will send information to Validic using the generic <code>post_to_validic</code> method which takes the object we’re posting (in this case ‘routine’) and sends in hash of fields.</p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Validic Gem Github Page</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Validic Gem Github Page</li>
          <li><a href="mailto:support@validic.com">support@validic.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/validic">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">validic</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/validic">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">validic</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">This is page is a work in progress to help showcase the many uses of the Validic gem.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
